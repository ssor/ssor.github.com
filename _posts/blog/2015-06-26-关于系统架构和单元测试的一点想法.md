---
layout: post
title: 关于系统架构和单元测试的一点想法
description: 单元测试不是孤立的，必须和系统架构结合
category: blog
---

###由来
最近在做一个简单的拣选系统，架构非常简单，前端HTML，后台基于国人用Go语言开发的Beego框架。

我一开始采用的架构是将控制逻辑和业务逻辑放到一起（以为很快就搞定这小项目），慢慢地代码多了感觉太乱，就抽时间将业务和控制逻辑区分开来，主要是把业务相关的部分用做单独Lib的思路提取出来。这样做的好处是测试就有了针对性，只要把业务逻辑部分测试过关，业务逻辑的正确性和稳定性就可以得到保证了。

###问题
现在问题来了，因为业务逻辑包要进行测试，那么：
* 应该测试哪部分函数？
* 这些函数最好不去使用全局变量，怎么办？

我倾向于做出原型之后再补充测试（，因为一开始无法确定合适的原型），补充测试的时候不会一次补充得太详细，需要确定一个第一阶段的范围

全局变量是必不可少的，因为业务的运行状态、缓存什么的都需要全局变量，那全局变量在什么层次带入函数中呢？

###结果
思考之后，我决定只在业务逻辑包与控制逻辑部分的交接层和业务逻辑包启动部分的函数中可以直接使用全局变量，其余函数只能使用通过参数带入

这样整理之后，我发现不仅测试简单明确了，而且测试的粒度都有层次感了，如果时间紧张，暂时只需要保证最上层的函数的测试基本可以保证系统的正常运行

###总结
从这件小事我得出一个简单的结论：考虑事情如果从本身得不到满意的结果，那可以试着从其所处的环境中多加考虑，就像单元测试，开始确实感觉无从下手，那么多数据结构，每个都测试下来，工作量实在太大，但如果从测试的目的结合项目的架构，一下子就明白最重要的测试工作从哪展开了




